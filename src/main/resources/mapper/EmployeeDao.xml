<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.hrnagemet.dao.EmployeeDao">

    <insert id="insertEmp" useGeneratedKeys="true" keyProperty="empno">
        INSERT INTO emp (ename, status, job, mgr, hiredate, sal, comm, deptno)
        VALUES (
                   #{ename},
                   #{status}::emp_status,
                   #{job},
                   #{mgr},
                   #{hiredate},
                   #{sal},
                   #{comm},
                   #{deptno}
               )
    </insert>

    <select id="selectEmp" resultType="com.example.hrnagemet.entity.Employee">
        SELECT
            empno, ename, status, job, mgr, hiredate, sal, comm, deptno
        FROM emp
        ORDER BY empno DESC
    </select>

    <select id="findById" resultType="com.example.hrnagemet.entity.Employee">
        SELECT
            empno,
            ename,
            status::text,  job,
            mgr,
            hiredate,
            sal,
            comm,
            deptno
        FROM emp
        WHERE empno = #{empno}
    </select>

    <update id="updateEmployeeDept">
        UPDATE emp
        SET deptno = #{deptno}
        WHERE empno = #{empno}
    </update>

    <delete id="deleteEmpById">
        DELETE FROM emp WHERE empno = #{empno}
    </delete>

    <update id="updateEmp">
        UPDATE emp
        <set>
            <if test="ename != null">ename = #{ename},</if>
            <if test="job != null">job = #{job},</if>
            <if test="mgr != null">mgr = #{mgr},</if> <if test="sal != null">sal = #{sal},</if>
            <if test="comm != null">comm = #{comm},</if> <if test="deptno != null">deptno = #{deptno},</if>
            <if test="status != null">status = #{status}::emp_status</if>
        </set>
        WHERE empno = #{empno}
    </update>



</mapper>